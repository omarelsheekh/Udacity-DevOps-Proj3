---

- name: install packages
  apt:
    name: [git, build-essential, curl, openssl, libssl-dev]
    state: latest
    update_cache: yes

- name: clone repos
  command: "chdir=/home/ {{ item }}"
  with_items:
    - git clone https://github.com/omarelsheekh/Udacity-DevOps-Proj3
    - curl -sL https://deb.nodesource.com/setup_13.x -o nodesource_setup.sh
  

- name: install node
  apt:
    name: nodejs
    state: latest

- name: installing dependencies and run the app
  command: "chdir=/home/Udacity-DevOps-Proj3/backend/ {{ item }}"
  with_items:
    - npm install
    - npm run start
    - npm install pm2 -g
    - pm2 start npm --name backend -- start
  register: runreg

- name: print nodereg
  debug:
    var: nodereg.stdout_lines

- name: print runreg
  debug:
    var: runreg.stdout_lines